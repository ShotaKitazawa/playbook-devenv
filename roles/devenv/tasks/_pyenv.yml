---

- name: "devenv.tasks._pyenv: Download pyenv"
  git:
    repo: "https://github.com/pyenv/pyenv.git"
    dest: "~/.pyenv"
    version: master

- name: "devenv.tasks._pyenv: Download pyenv-virtualenv"
  git:
    repo: "https://github.com/pyenv/pyenv-virtualenv.git"
    dest: "~/.pyenv/plugins/pyenv-virtualenv"
    version: master

- name: "devenv.tasks._pyenv: Deploy profile"
  copy:
    src: "bash_pyenv"
    dest: "~/.bash_pyenv"

- name: "devenv.tasks.main: Check bash_profile"
  ignore_errors: True
  shell: "egrep '^if [ -e ~/.bash_pyenv ]; then . ~/.bash_pyenv; fi$' ~/.bash_profile"
  register: no_such_row

- name: "roles.docker.tasks.main: Postscript bash_profile"
  shell: "echo 'if [ -e ~/.bash_pyenv ]; then . ~/.bash_pyenv; fi' >> ~/.bash_profile"
  when: no_such_row.rc == 1
